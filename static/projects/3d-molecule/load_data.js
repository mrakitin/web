var cif = "#generated using pymatgen                     \n"+
"data_H4C3O                                    \n"+
"_symmetry_space_group_name_H-M   'P 1'        \n"+
"_cell_length_a   8.51400000                   \n"+
"_cell_length_b   10.86400000                  \n"+
"_cell_length_c   8.26100000                   \n"+
"_cell_angle_alpha   97.57000000               \n"+
"_cell_angle_beta   79.57500000                \n"+
"_cell_angle_gamma   86.70700000               \n"+
"_symmetry_Int_Tables_number   1               \n"+
"_chemical_formula_structural   H4C3O          \n"+
"_chemical_formula_sum   'H32 C24 O8'          \n"+
"_cell_volume   742.353781619                  \n"+
"_cell_formula_units_Z   8                     \n"+
"loop_                                         \n"+
" _symmetry_equiv_pos_site_id                  \n"+
" _symmetry_equiv_pos_as_xyz                   \n"+
"  1  'x, y, z'                                \n"+
"loop_                                         \n"+
" _atom_site_type_symbol                       \n"+
" _atom_site_label                             \n"+
" _atom_site_symmetry_multiplicity             \n"+
" _atom_site_fract_x                           \n"+
" _atom_site_fract_y                           \n"+
" _atom_site_fract_z                           \n"+
" _atom_site_occupancy                         \n"+
"  H  H1  1  0.897600  0.974000  0.514800  1.0 \n"+
"  H  H2  1  0.361000  0.190500  0.147900  1.0 \n"+
"  H  H3  1  0.334100  0.313200  0.865400  1.0 \n"+
"  H  H4  1  0.944000  0.561900  0.815900  1.0 \n"+
"  H  H5  1  0.842500  0.833100  0.606900  1.0 \n"+
"  H  H6  1  0.237700  0.808200  0.180700  1.0 \n"+
"  H  H7  1  0.991300  0.482000  0.091000  1.0 \n"+
"  H  H8  1  0.658000  0.864900  0.929100  1.0 \n"+
"  H  H9  1  0.833300  0.875900  0.246600  1.0 \n"+
"  H  H10  1  0.315300  0.591900  0.032400  1.0\n"+
"  H  H11  1  0.137100  0.098500  0.594500  1.0\n"+
"  H  H12  1  0.753900  0.659200  0.454600  1.0\n"+
"  H  H13  1  0.478400  0.945700  0.266800  1.0\n"+
"  H  H14  1  0.979500  0.382300  0.347900  1.0\n"+
"  H  H15  1  0.189900  0.315100  0.543500  1.0\n"+
"  H  H16  1  0.107000  0.860500  0.942400  1.0\n"+
"  H  H17  1  0.532700  0.224200  0.342100  1.0\n"+
"  H  H18  1  0.229400  0.123200  0.780400  1.0\n"+
"  H  H19  1  0.136100  0.762700  0.646600  1.0\n"+
"  H  H20  1  0.630500  0.436900  0.877400  1.0\n"+
"  H  H21  1  0.995800  0.729100  0.008100  1.0\n"+
"  H  H22  1  0.370900  0.548400  0.385300  1.0\n"+
"  H  H23  1  0.811900  0.216800  0.625900  1.0\n"+
"  H  H24  1  0.633300  0.701700  0.960700  1.0\n"+
"  H  H25  1  0.452800  0.685400  0.753400  1.0\n"+
"  H  H26  1  0.980500  0.327900  0.971400  1.0\n"+
"  H  H27  1  0.963800  0.143800  0.096100  1.0\n"+
"  H  H28  1  0.280100  0.756500  0.373400  1.0\n"+
"  H  H29  1  0.530300  0.962400  0.741900  1.0\n"+
"  H  H30  1  0.619600  0.096200  0.432800  1.0\n"+
"  H  H31  1  0.719100  0.442300  0.657800  1.0\n"+
"  H  H32  1  0.644800  0.252700  0.000500  1.0\n"+
"  C  C33  1  0.058500  0.773300  0.908000  1.0\n"+
"  C  C34  1  0.966100  0.194200  0.221100  1.0\n"+
"  C  C35  1  0.302100  0.356700  0.760600  1.0\n"+
"  C  C36  1  0.696100  0.388600  0.759400  1.0\n"+
"  C  C37  1  0.976900  0.329500  0.227900  1.0\n"+
"  C  C38  1  0.318000  0.617400  0.163000  1.0\n"+
"  C  C39  1  0.821300  0.829200  0.355600  1.0\n"+
"  C  C40  1  0.764500  0.703500  0.340300  1.0\n"+
"  C  C41  1  0.194800  0.159800  0.675000  1.0\n"+
"  C  C42  1  0.604800  0.778900  0.898100  1.0\n"+
"  C  C43  1  0.507700  0.770200  0.786800  1.0\n"+
"  C  C44  1  0.369900  0.518400  0.252200  1.0\n"+
"  C  C45  1  0.471800  0.877700  0.704200  1.0\n"+
"  C  C46  1  0.468700  0.044700  0.261100  1.0\n"+
"  C  C47  1  0.367500  0.088700  0.150000  1.0\n"+
"  C  C48  1  0.746100  0.267400  0.742300  1.0\n"+
"  C  C49  1  0.276200  0.733700  0.242600  1.0\n"+
"  C  C50  1  0.544700  0.125600  0.350300  1.0\n"+
"  C  C51  1  0.006300  0.601600  0.707500  1.0\n"+
"  C  C52  1  0.855700  0.882000  0.499800  1.0\n"+
"  C  C53  1  0.074200  0.720700  0.749100  1.0\n"+
"  C  C54  1  0.712300  0.197500  0.884000  1.0\n"+
"  C  C55  1  0.983300  0.383100  0.089900  1.0\n"+
"  C  C56  1  0.223100  0.276200  0.647700  1.0\n"+
"  O  O57  1  0.331700  0.463800  0.743300  1.0\n"+
"  O  O58  1  0.294800  0.020300  0.064900  1.0\n"+
"  O  O59  1  0.754300  0.086700  0.877400  1.0\n"+
"  O  O60  1  0.016100  0.548200  0.565200  1.0\n"+
"  O  O61  1  0.384300  0.876400  0.601400  1.0\n"+
"  O  O62  1  0.959800  0.139000  0.342100  1.0\n"+
"  O  O63  1  0.730900  0.649600  0.212600  1.0\n"+
"  O  O64  1  0.409800  0.410300  0.187400  1.0\n";

function loadCIF(cif) {
    var op = {};
    var ls = cif.split("\n");
    for (var i = 0; i < ls.length; i++) {
        var l = ls[i];
        if        (l.startsWith("_cell_length_a")) {
            op["length_a"] = parseFloat(l.split(/\s+/)[1]);
        } else if (l.startsWith("_cell_length_b")) {
            op["length_b"] = parseFloat(l.split(/\s+/)[1]);
        } else if (l.startsWith("_cell_length_c")) {
            op["length_c"] = parseFloat(l.split(/\s+/)[1]);
        } else if (l.startsWith("_cell_angle_alpha")) {
            op["angle_alpha"] = parseFloat(l.split(/\s+/)[1]);
        } else if (l.startsWith("_cell_angle_beta")) {
            op["angle_beta"] = parseFloat(l.split(/\s+/)[1]);
        } else if (l.startsWith("_cell_angle_gamma")) {
            op["angle_gamma"] = parseFloat(l.split(/\s+/)[1]);
            break;
        }
    }
    
    xtalpiscene.init($("#visualize"));
    cif = new CIF(xtalpiscene, op);

    for (var i = 0; i < ls.length; i++) {
        var l = ls[i];
        if (/^  [A-Z]/.test(l)) {
            var atom = l.trim().split(/\s+/);
            cif.addAtom(parseFloat(atom[3]), parseFloat(atom[4]), parseFloat(atom[5]), atom[0]);
        }
    }

    cif.draw();
    animate();
}

var mol_file = "MOL_name\n"+
"Number of atoms: 32\n"+
"   H   -0.0218  -1.5642  -5.1039   0  0  0  1\n"+
"   C   -0.0002  -1.1069  -4.2946   1  0  0  1\n"+
"   C   -0.2352   0.2453  -4.2818   2  1  0  1\n"+
"   C    0.2682  -1.8051  -3.1287   2  1  3  0\n"+
"   C   -0.2180   0.9763  -3.1055   3  2  1  0\n"+
"   H   -0.4107   0.6823  -5.0839   3  2  5  0\n"+
"   H    0.4412  -2.7190  -3.1376   4  2  1  0\n"+
"   C    0.2673  -1.0836  -1.9542   4  2  7  0\n"+
"   C    0.0140   0.2681  -1.9285   5  3  2  0\n"+
"   N   -0.4517   2.3457  -3.0755   5  3  9  0\n"+
"   C    0.4979  -1.5417  -0.5704   8  4  9  0\n"+
"   C    0.0365   0.7684  -0.5180   9  5  8  0\n"+
"   H    0.1113   2.7177  -2.4732  10  5  3  0\n"+
"   H   -0.3992   2.6744  -3.8179  10  5 13  0\n"+
"   N    0.3960  -0.4377   0.2261  11  8  4  0\n"+
"   O    0.7441  -2.6742  -0.1742  11  8 15  0\n"+
"   H   -0.8325   1.1042  -0.2483  12  9 15  0\n"+
"   H    0.6994   1.4668  -0.4010  12  9 15  0\n"+
"   C    0.2879  -0.5407   1.6584  15 11 12  0\n"+
"   C    0.9169   0.6263   2.4115  19 15 11  0\n"+
"   H    0.7586  -1.3554   1.9316  19 15 20  0\n"+
"   C   -1.1643  -0.6891   2.0819  19 15 20  0\n"+
"   C    0.8108   0.3837   3.9079  20 19 15  0\n"+
"   H    0.4606   1.4506   2.1798  20 19 23  0\n"+
"   H    1.8490   0.7150   2.1595  20 19 23  0\n"+
"   N   -1.4411  -0.4445   3.4029  22 19 15  0\n"+
"   O   -2.0474  -1.0317   1.3172  22 19 26  0\n"+
"   C   -0.5862   0.0790   4.3567  23 20 19  0\n"+
"   H    1.1281   1.1706   4.3782  23 20 28  0\n"+
"   H    1.3877  -0.3579   4.1490  23 20 28  0\n"+
"   H   -2.2704  -0.5975   3.6614  26 22 28  0\n"+
"   O   -0.9967   0.2747   5.4749  28 23 26  0\n";

var mol_xyz = "35\n"+
"\n"+
"Cl         0.18500        1.28170        2.33150\n"+
"C          1.79670        1.47030        1.63920\n"+
"C          2.51910        2.60320        2.03280\n"+
"C          3.81960        2.80810        1.57900\n"+
"C          4.41690        1.87840        0.73270\n"+
"C          3.71560        0.74000        0.32130\n"+
"Cl         4.53960       -0.36400       -0.77930\n"+
"C          2.38600        0.52010        0.76010\n"+
"C          1.65610       -0.68780        0.29040\n"+
"N          0.35870       -0.72960        0.27670\n"+
"N         -0.40200       -1.81830       -0.19590\n"+
"C         -1.79420       -1.59390       -0.48180\n"+
"N         -2.73370       -2.56070       -0.46270\n"+
"N         -3.89460       -1.97350       -0.72580\n"+
"C         -3.65170       -0.65690       -0.88980\n"+
"N         -2.34540       -0.38910       -0.71880\n"+
"N         -1.68080        0.81700       -1.00630\n"+
"C         -2.16850        2.09350       -0.57150\n"+
"O         -1.68350        3.14160       -1.07470\n"+
"C         -3.23240        2.21370        0.47430\n"+
"C          0.13120       -3.15820       -0.21000\n"+
"O          0.90110       -3.53820        0.71290\n"+
"C         -0.24280       -4.12780       -1.28790\n"+
"H          2.07240        3.32760        2.70180\n"+
"H          4.37040        3.68660        1.89080\n"+
"H          5.42950        2.04800        0.38800\n"+
"H          2.21730       -1.51160       -0.12660\n"+
"H         -4.40160        0.06920       -1.17260\n"+
"H         -0.77870        0.78640       -1.53240\n"+
"H         -3.10210        3.15810        1.04330\n"+
"H         -3.16780        1.36800        1.19100\n"+
"H         -4.23240        2.22120       -0.00600\n"+
"H         -0.60710       -3.58480       -2.18530\n"+
"H          0.64360       -4.73150       -1.57670\n"+
"H         -1.03970       -4.80660       -0.91890\n";

var xyz_addl = "SINGLE 0 1\n"+
    "AROMATIC 1 2\n"+
    "AROMATIC 2 3\n"+
    "AROMATIC 3 4\n"+
    "AROMATIC 4 5\n"+
    "SINGLE 5 6\n"+
    "AROMATIC 5 7\n"+
    "FIX 7 8\n"+
    "DOUBLE 8 9\n"+
    "FIX 9 10\n"+
    "FIX 10 11\n"+
    "AROMATIC 11 12\n"+
    "AROMATIC 12 13\n"+
    "AROMATIC 13 14\n"+
    "AROMATIC 14 15\n"+
    "FIX 15 16\n"+
    "FIX 16 17\n"+
    "DOUBLE 17 18\n"+
    "SINGLE 17 19\n"+
    "FIX 10 20\n"+
    "DOUBLE 20 21\n"+
    "SINGLE 20 22\n"+
    "AROMATIC 7 1\n"+
    "AROMATIC 15 11\n"+
    "SINGLE 2 23\n"+
    "SINGLE 3 24\n"+
    "SINGLE 4 25\n"+
    "SINGLE 8 26\n"+
    "SINGLE 32 22\n"+
    "SINGLE 33 22\n"+
    "SINGLE 34 22\n"+
    "SINGLE 14 27\n"+
    "SINGLE 16 28\n"+
    "SINGLE 19 29\n"+
    "SINGLE 19 30\n"+
    "SINGLE 19 31\n";

var sorted_all = {'conns': [[0, 1, 'FIX'], [0, 2, 'FIX'], [0, 18, 'SINGLE'], [2, 3, 'SINGLE'], [2, 5, 'SINGLE'], [2, 13, 'SINGLE'], [3, 4, 'SINGLE'], [3, 14, 'SINGLE'], [3, 15, 'SINGLE'], [4, 16, 'SINGLE'], [4, 17, 'SINGLE'], [4, 6, 'SINGLE'], [5, 6, 'AROMATIC'], [5, 7, 'AROMATIC'], [6, 8, 'AROMATIC'], [7, 9, 'AROMATIC'], [7, 19, 'SINGLE'], [8, 10, 'AROMATIC'], [8, 20, 'SINGLE'], [1, 11, 'FIX'], [1, 21, 'SINGLE'], [1, 22, 'SINGLE'], [9, 10, 'AROMATIC'], [9, 23, 'SINGLE'], [10, 24, 'SINGLE'], [11, 12, 'TRIPLE'], [12, 25, 'SINGLE']], 'xyz': '26\nH13 C12 N1\nN 0.000000 0.000000 0.000000\nC 0.000000 0.000000 1.457220\nC 1.357437 0.000000 -0.521691\nC 2.085076 1.315818 -0.175623\nC 3.153892 1.512651 -1.260664\nC 1.457238 0.010815 -2.021078\nC 2.485716 0.869459 -2.435759\nC 0.739026 -0.730525 -2.946706\nC 2.808479 1.009267 -3.775494\nC 1.049145 -0.585292 -4.301162\nC 2.075638 0.278819 -4.712502\nC -1.369446 0.013006 1.981017\nC -2.488728 0.023242 2.415275\nH 1.927337 -0.862589 -0.151357\nH 2.530452 1.306572 0.824950\nH 1.388565 2.166885 -0.215363\nH 4.076724 0.978944 -1.011858\nH 3.364387 2.572907 -1.426025\nH -0.486332 -0.833875 -0.330888\nH -0.043996 -1.414582 -2.637584\nH 3.610738 1.666021 -4.094193\nH 0.521952 -0.885922 1.838293\nH 0.512174 0.882387 1.855444\nH 0.495929 -1.153021 -5.044573\nH 2.306454 0.372907 -5.770225\nH -3.481533 0.032341 2.800346', 'da_conns': [[1, 11]]};

function loadMOL(sorted_all) {
    xtalpiscene.init($("#visualize"));
    var mol = new MOL(xtalpiscene);
    var ms = sorted_all.xyz.trim().split("\n");
    for (var i = 2; i < ms.length; i++) {
        var ps = ms[i].trim().split(/\s+/);
        mol.addAtom(parseFloat(ps[1]), parseFloat(ps[2]), parseFloat(ps[3]), ps[0]);
    }
    
    mol.addConn(sorted_all.conns, sorted_all.da_conns);
    mol.draw();
    animate();
}

$(function () {
    // loadCIF(cif);
    // loadMOL(sorted_all);
    if (window.data_sorted_all)
        loadMOL(window.data_sorted_all);
    else
        loadMOL({xyz: window.data_xyz, conns:window.data_conns, da_conns:[]});
});